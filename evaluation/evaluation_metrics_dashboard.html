<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Evaluation Metrics Dashboard</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap');

  :root {
    --navy: #1a2332;
    --navy-light: #2a3a4e;
    --cream: #f5f0e8;
    --cream-light: #faf7f2;
    --cream-dark: #e8e0d4;
    --blue-accent: #3b6cb5;
    --blue-light: #5a8fd4;
    --red-accent: #c0392b;
    --green-accent: #27ae60;
    --orange-accent: #e67e22;
    --purple-accent: #8e44ad;
    --teal-accent: #16a085;
    --text-dark: #2c3e50;
    --text-muted: #7f8c8d;
    --card-shadow: 0 2px 12px rgba(26, 35, 50, 0.08);
    --card-shadow-hover: 0 6px 24px rgba(26, 35, 50, 0.14);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--cream);
    color: var(--text-dark);
    min-height: 100vh;
  }

  /* Top Nav */
  .top-nav {
    background: var(--navy);
    color: white;
    padding: 10px 24px;
    display: flex;
    align-items: center;
    gap: 16px;
    font-size: 13px;
  }
  .top-nav span { opacity: 0.7; cursor: pointer; }
  .top-nav span:hover { opacity: 1; }

  /* Tabs */
  .tabs-bar {
    background: white;
    border-bottom: 1px solid var(--cream-dark);
    padding: 0 24px;
    display: flex;
    align-items: center;
    gap: 0;
  }
  .tab {
    padding: 14px 20px;
    font-size: 14px;
    font-weight: 500;
    color: var(--text-muted);
    cursor: pointer;
    border-bottom: 3px solid transparent;
    transition: all 0.2s;
  }
  .tab:hover { color: var(--text-dark); }
  .tab.active {
    color: white;
    background: var(--blue-accent);
    border-radius: 6px 6px 0 0;
    border-bottom: 3px solid var(--blue-accent);
  }
  .logged-in {
    margin-left: auto;
    font-size: 12px;
    color: var(--text-muted);
  }
  .logged-in strong { color: var(--text-dark); font-size: 14px; }

  /* Main Content */
  .main {
    padding: 24px;
    max-width: 1400px;
    margin: 0 auto;
  }

  .section-title {
    font-family: 'Plus Jakarta Sans', sans-serif;
    font-size: 22px;
    font-weight: 800;
    color: var(--navy);
    margin-bottom: 6px;
  }
  .section-subtitle {
    font-size: 13px;
    color: var(--text-muted);
    margin-bottom: 20px;
  }

  /* Query Bar */
  .query-bar {
    background: white;
    border: 1px solid var(--cream-dark);
    border-radius: 10px;
    padding: 12px 18px;
    margin-bottom: 24px;
    display: flex;
    align-items: center;
    gap: 12px;
    font-size: 13px;
    color: var(--text-dark);
  }
  .query-icon {
    width: 28px; height: 28px;
    background: var(--blue-accent);
    border-radius: 6px;
    display: flex; align-items: center; justify-content: center;
    color: white; font-size: 14px; flex-shrink: 0;
  }
  .query-text { flex: 1; }
  .query-actions { display: flex; gap: 8px; }
  .btn-sm {
    padding: 6px 14px;
    border-radius: 6px;
    border: 1px solid var(--cream-dark);
    background: var(--cream-light);
    font-size: 12px;
    cursor: pointer;
    font-family: inherit;
    transition: all 0.2s;
  }
  .btn-sm:hover { background: var(--cream-dark); }

  /* Score Cards */
  .cards-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 14px;
    margin-bottom: 32px;
  }
  .score-card {
    background: var(--cream-light);
    border: 1px solid var(--cream-dark);
    border-radius: 12px;
    padding: 18px 14px;
    text-align: center;
    transition: all 0.3s;
    position: relative;
    overflow: hidden;
  }
  .score-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 3px;
    background: var(--blue-accent);
    opacity: 0;
    transition: opacity 0.3s;
  }
  .score-card:hover {
    box-shadow: var(--card-shadow-hover);
    transform: translateY(-2px);
  }
  .score-card:hover::before { opacity: 1; }
  .score-label {
    font-size: 10px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--text-muted);
    margin-bottom: 8px;
  }
  .score-value {
    font-family: 'Plus Jakarta Sans', sans-serif;
    font-size: 36px;
    font-weight: 800;
    color: var(--navy);
    line-height: 1;
    margin-bottom: 6px;
  }
  .score-value.good { color: var(--green-accent); }
  .score-value.warning { color: var(--orange-accent); }
  .score-value.danger { color: var(--red-accent); }
  .score-desc {
    font-size: 10px;
    color: var(--text-muted);
    line-height: 1.3;
  }

  /* Charts Section */
  .section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 20px;
    margin-top: 8px;
  }

  .charts-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 24px;
  }

  .chart-card {
    background: white;
    border: 1px solid var(--cream-dark);
    border-radius: 14px;
    padding: 22px;
    box-shadow: var(--card-shadow);
    transition: box-shadow 0.3s;
  }
  .chart-card:hover { box-shadow: var(--card-shadow-hover); }
  .chart-card.full-width {
    grid-column: 1 / -1;
  }

  .chart-title {
    font-family: 'Plus Jakarta Sans', sans-serif;
    font-size: 15px;
    font-weight: 700;
    color: var(--navy);
    margin-bottom: 4px;
  }
  .chart-desc {
    font-size: 11px;
    color: var(--text-muted);
    margin-bottom: 16px;
  }

  .chart-container {
    position: relative;
    width: 100%;
    height: 280px;
  }
  .chart-container.tall { height: 320px; }
  .chart-container.short { height: 240px; }

  /* Bottom Row - 3 col */
  .charts-grid-3 {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 20px;
    margin-bottom: 24px;
  }

  /* Heatmap custom */
  .heatmap-grid {
    display: grid;
    gap: 3px;
    margin-top: 10px;
  }
  .heatmap-cell {
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    font-weight: 600;
    color: white;
    height: 38px;
    transition: transform 0.15s;
    cursor: default;
  }
  .heatmap-cell:hover { transform: scale(1.08); z-index: 2; }
  .heatmap-header {
    font-size: 9px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--text-muted);
    display: flex;
    align-items: center;
    justify-content: center;
    background: transparent !important;
  }
  .heatmap-row-label {
    font-size: 10px;
    font-weight: 600;
    color: var(--text-dark);
    display: flex;
    align-items: center;
    justify-content: flex-end;
    padding-right: 8px;
    background: transparent !important;
  }

  /* Legend */
  .legend-bar {
    display: flex;
    align-items: center;
    gap: 16px;
    margin-top: 12px;
    justify-content: center;
  }
  .legend-item {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 11px;
    color: var(--text-muted);
  }
  .legend-dot {
    width: 10px; height: 10px;
    border-radius: 50%;
  }

  /* Pass/Fail Badges */
  .pass-fail-grid {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 10px;
    margin-top: 10px;
  }
  .pf-item {
    text-align: center;
    padding: 12px 6px;
    border-radius: 10px;
    background: var(--cream-light);
    border: 1px solid var(--cream-dark);
  }
  .pf-label {
    font-size: 9px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--text-muted);
    margin-bottom: 8px;
  }
  .pf-bar {
    height: 8px;
    border-radius: 4px;
    background: var(--cream-dark);
    overflow: hidden;
    margin-bottom: 6px;
  }
  .pf-fill {
    height: 100%;
    border-radius: 4px;
    transition: width 1s ease;
  }
  .pf-fill.green { background: var(--green-accent); }
  .pf-fill.red { background: var(--red-accent); }
  .pf-fill.orange { background: var(--orange-accent); }
  .pf-stat {
    font-size: 12px;
    font-weight: 700;
  }
  .pf-stat .pass { color: var(--green-accent); }
  .pf-stat .fail { color: var(--red-accent); }

  /* Insight Box */
  .insight-box {
    background: linear-gradient(135deg, var(--navy) 0%, var(--navy-light) 100%);
    border-radius: 14px;
    padding: 24px;
    color: white;
    margin-top: 24px;
  }
  .insight-box h3 {
    font-family: 'Plus Jakarta Sans', sans-serif;
    font-size: 16px;
    font-weight: 700;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .insight-list {
    list-style: none;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
  }
  .insight-list li {
    font-size: 13px;
    padding: 10px 14px;
    background: rgba(255,255,255,0.08);
    border-radius: 8px;
    border-left: 3px solid var(--blue-light);
    line-height: 1.4;
  }

  @media (max-width: 1100px) {
    .cards-grid { grid-template-columns: repeat(4, 1fr); }
    .charts-grid-3 { grid-template-columns: 1fr 1fr; }
  }
  @media (max-width: 768px) {
    .cards-grid { grid-template-columns: repeat(2, 1fr); }
    .charts-grid { grid-template-columns: 1fr; }
    .charts-grid-3 { grid-template-columns: 1fr; }
    .insight-list { grid-template-columns: 1fr; }
    .pass-fail-grid { grid-template-columns: repeat(3, 1fr); }
  }
</style>
</head>
<body>

<!-- Top Nav -->
<div class="top-nav">
  <span>üìä My Workstation</span>
  <span>üìÖ Timesheet</span>
  <span>üìã PEARL</span>
  <span>GCP Portal</span>
  <span>API Gateway</span>
  <span>Devops</span>
  <span style="margin-left:auto; opacity:1; font-weight:600;">Domain_Agents_Bac...</span>
</div>

<!-- Tabs -->
<div class="tabs-bar">
  <div class="tab">Chat</div>
  <div class="tab">Trace</div>
  <div class="tab active">Metrics</div>
  <div class="logged-in">
    LOGGED IN AS<br>
    <strong>128803798001</strong>
  </div>
</div>

<!-- Main -->
<div class="main">
  <div class="section-title">Evaluation Metrics</div>
  <div class="section-subtitle">AI Response Quality Assessment ‚Äî Aggregate across 20 evaluated queries</div>

  <!-- Query Bar -->
  <div class="query-bar">
    <div class="query-icon">‚ñº</div>
    <div class="query-text">What are the names of my current medical insurance plans, and who all is covered under these benefit plans?</div>
    <div class="query-actions">
      <button class="btn-sm">‚Üª Refresh</button>
      <button class="btn-sm">‚Üì Download CSV</button>
    </div>
  </div>

  <!-- Score Cards -->
  <div class="cards-grid">
    <div class="score-card">
      <div class="score-label">Harmlessness</div>
      <div class="score-value good">5</div>
      <div class="score-desc">Avg. harmlessness score of responses (1-5)</div>
    </div>
    <div class="score-card">
      <div class="score-label">Conciseness</div>
      <div class="score-value good">5</div>
      <div class="score-desc">Avg. conciseness score of responses (1-5)</div>
    </div>
    <div class="score-card">
      <div class="score-label">Malice</div>
      <div class="score-value good">5</div>
      <div class="score-desc">Avg. malice score (1-5, lower is better)</div>
    </div>
    <div class="score-card">
      <div class="score-label">Fairness</div>
      <div class="score-value good">5</div>
      <div class="score-desc">Avg. fairness score of responses (1-5)</div>
    </div>
    <div class="score-card">
      <div class="score-label">Toxicity</div>
      <div class="score-value good">1</div>
      <div class="score-desc">Avg. toxicity score (1-5, lower is better)</div>
    </div>
    <div class="score-card">
      <div class="score-label">Correctness</div>
      <div class="score-value good">5</div>
      <div class="score-desc">Avg. correctness of answers (1-5)</div>
    </div>
    <div class="score-card">
      <div class="score-label">Tool Match</div>
      <div class="score-value danger">0</div>
      <div class="score-desc">Avg. tool name match score (0-1)</div>
    </div>
  </div>

  <!-- Interactive Graphics Section -->
  <div class="section-header">
    <div>
      <div class="section-title">Interactive Graphics & Trends</div>
      <div class="section-subtitle">Visual story of your AI agent's evaluation performance</div>
    </div>
  </div>

  <!-- Row 1: Radar + Trend Line -->
  <div class="charts-grid">
    <div class="chart-card">
      <div class="chart-title">üéØ Quality Snapshot ‚Äî Radar View</div>
      <div class="chart-desc">All metrics at a glance for the selected query. Ideal shape = full pentagon.</div>
      <div class="chart-container">
        <canvas id="radarChart"></canvas>
      </div>
    </div>
    <div class="chart-card">
      <div class="chart-title">üìà Score Trends Over Queries</div>
      <div class="chart-desc">Track how each metric evolves across evaluated queries over time.</div>
      <div class="chart-container">
        <canvas id="trendChart"></canvas>
      </div>
    </div>
  </div>

  <!-- Row 2: Distribution + Correlation -->
  <div class="charts-grid">
    <div class="chart-card">
      <div class="chart-title">üìä Score Distribution per Metric</div>
      <div class="chart-desc">How scores are spread ‚Äî helps identify consistency vs variance in responses.</div>
      <div class="chart-container">
        <canvas id="distributionChart"></canvas>
      </div>
    </div>
    <div class="chart-card">
      <div class="chart-title">üîó Metric Correlation: Correctness vs Conciseness</div>
      <div class="chart-desc">Are correct answers also concise? Scatter reveals the relationship.</div>
      <div class="chart-container">
        <canvas id="scatterChart"></canvas>
      </div>
    </div>
  </div>

  <!-- Row 3: Heatmap (full width) -->
  <div class="charts-grid">
    <div class="chart-card full-width">
      <div class="chart-title">üó∫Ô∏è Query √ó Metric Heatmap</div>
      <div class="chart-desc">Each row is a query, each column a metric. Dark green = high score, red = needs attention. Spot patterns instantly.</div>
      <div id="heatmapContainer"></div>
    </div>
  </div>

  <!-- Row 4: 3-col ‚Äî Pass/Fail, Donut, Grouped Bar -->
  <div class="charts-grid-3">
    <div class="chart-card">
      <div class="chart-title">‚úÖ Pass / Fail Summary</div>
      <div class="chart-desc">Threshold: score ‚â• 4 is Pass. How many queries meet the bar?</div>
      <div id="passFailContainer"></div>
    </div>
    <div class="chart-card">
      <div class="chart-title">üéØ Tool Match Rate</div>
      <div class="chart-desc">Correct tool selection across all evaluated queries.</div>
      <div class="chart-container short">
        <canvas id="donutChart"></canvas>
      </div>
    </div>
    <div class="chart-card">
      <div class="chart-title">üìä Metric Comparison Across Query Types</div>
      <div class="chart-desc">How different query categories score on each metric.</div>
      <div class="chart-container short">
        <canvas id="groupedBarChart"></canvas>
      </div>
    </div>
  </div>

  <!-- AI Insights -->
  <div class="insight-box">
    <h3>üí° Key Insights & Recommendations</h3>
    <ul class="insight-list">
      <li><strong>Harmlessness & Fairness:</strong> Consistently scoring 5/5 ‚Äî model shows strong safety alignment across all query types.</li>
      <li><strong>Toxicity:</strong> Extremely low (avg 1.0) ‚Äî responses are clean and appropriate for enterprise use.</li>
      <li><strong>Tool Match = 0:</strong> Critical gap ‚Äî the agent is not selecting the correct tools. Investigate tool routing logic.</li>
      <li><strong>Correlation found:</strong> High correctness queries tend to also score well on conciseness, suggesting well-trained retrieval.</li>
    </ul>
  </div>
</div>

<script>
// Color Palette
const COLORS = {
  navy: '#1a2332',
  blue: '#3b6cb5',
  blueLight: '#5a8fd4',
  green: '#27ae60',
  red: '#c0392b',
  orange: '#e67e22',
  purple: '#8e44ad',
  teal: '#16a085',
  cream: '#f5f0e8',
  creamDark: '#e8e0d4',
};

// Simulated Data
const queryLabels = ['Q1','Q2','Q3','Q4','Q5','Q6','Q7','Q8','Q9','Q10','Q11','Q12','Q13','Q14','Q15','Q16','Q17','Q18','Q19','Q20'];
const metrics = ['Harmlessness','Conciseness','Malice','Fairness','Toxicity','Correctness'];

function randScore(base, variance) {
  return Math.max(1, Math.min(5, base + (Math.random() * variance * 2 - variance)));
}

// Generate per-query scores
const data = {};
metrics.forEach(m => { data[m] = []; });
queryLabels.forEach((_, i) => {
  data['Harmlessness'].push(randScore(4.8, 0.3));
  data['Conciseness'].push(randScore(4.5, 0.8));
  data['Malice'].push(randScore(4.7, 0.5));
  data['Fairness'].push(randScore(4.9, 0.2));
  data['Toxicity'].push(randScore(1.2, 0.4));
  data['Correctness'].push(randScore(4.4, 1.0));
});

// Chart.js defaults
Chart.defaults.font.family = "'DM Sans', sans-serif";
Chart.defaults.font.size = 11;
Chart.defaults.color = '#7f8c8d';

// 1. RADAR CHART
new Chart(document.getElementById('radarChart'), {
  type: 'radar',
  data: {
    labels: ['Harmlessness', 'Conciseness', 'Fairness', 'Correctness', 'Low Toxicity', 'Low Malice'],
    datasets: [{
      label: 'Current Query',
      data: [5, 5, 5, 5, 5, 5],
      borderColor: COLORS.blue,
      backgroundColor: 'rgba(59, 108, 181, 0.15)',
      borderWidth: 2.5,
      pointRadius: 5,
      pointBackgroundColor: COLORS.blue,
      pointBorderColor: '#fff',
      pointBorderWidth: 2,
    }, {
      label: 'Average (All Queries)',
      data: [4.8, 4.5, 4.9, 4.4, 4.8, 4.7],
      borderColor: COLORS.orange,
      backgroundColor: 'rgba(230, 126, 34, 0.08)',
      borderWidth: 2,
      borderDash: [5, 5],
      pointRadius: 4,
      pointBackgroundColor: COLORS.orange,
      pointBorderColor: '#fff',
      pointBorderWidth: 2,
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      r: {
        min: 0, max: 5,
        ticks: { stepSize: 1, backdropColor: 'transparent', font: { size: 10 } },
        grid: { color: 'rgba(0,0,0,0.06)' },
        pointLabels: { font: { size: 11, weight: '600' }, color: COLORS.navy }
      }
    },
    plugins: {
      legend: { position: 'bottom', labels: { padding: 16, usePointStyle: true, pointStyle: 'circle' } }
    }
  }
});

// 2. TREND LINE CHART
const metricColors = [COLORS.blue, COLORS.green, COLORS.purple, COLORS.teal, COLORS.red, COLORS.orange];
new Chart(document.getElementById('trendChart'), {
  type: 'line',
  data: {
    labels: queryLabels,
    datasets: metrics.map((m, i) => ({
      label: m,
      data: data[m].map(v => +v.toFixed(2)),
      borderColor: metricColors[i],
      backgroundColor: 'transparent',
      borderWidth: 2,
      pointRadius: 3,
      pointHoverRadius: 6,
      tension: 0.35,
    }))
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      y: { min: 0, max: 5.5, grid: { color: 'rgba(0,0,0,0.04)' } },
      x: { grid: { display: false } }
    },
    plugins: {
      legend: { position: 'bottom', labels: { padding: 12, usePointStyle: true, pointStyle: 'circle', font: { size: 10 } } },
      tooltip: { mode: 'index', intersect: false }
    },
    interaction: { mode: 'nearest', intersect: false }
  }
});

// 3. DISTRIBUTION (Box-style via grouped bar with min/max/avg)
const distLabels = metrics;
const avgScores = metrics.map(m => +(data[m].reduce((a,b)=>a+b,0)/data[m].length).toFixed(2));
const minScores = metrics.map(m => +Math.min(...data[m]).toFixed(2));
const maxScores = metrics.map(m => +Math.max(...data[m]).toFixed(2));

new Chart(document.getElementById('distributionChart'), {
  type: 'bar',
  data: {
    labels: distLabels,
    datasets: [
      { label: 'Min', data: minScores, backgroundColor: 'rgba(192, 57, 43, 0.25)', borderColor: COLORS.red, borderWidth: 1, borderRadius: 4 },
      { label: 'Average', data: avgScores, backgroundColor: 'rgba(59, 108, 181, 0.35)', borderColor: COLORS.blue, borderWidth: 1, borderRadius: 4 },
      { label: 'Max', data: maxScores, backgroundColor: 'rgba(39, 174, 96, 0.25)', borderColor: COLORS.green, borderWidth: 1, borderRadius: 4 },
    ]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      y: { min: 0, max: 5.5, grid: { color: 'rgba(0,0,0,0.04)' } },
      x: { grid: { display: false } }
    },
    plugins: {
      legend: { position: 'bottom', labels: { padding: 12, usePointStyle: true, pointStyle: 'rect' } }
    }
  }
});

// 4. SCATTER CHART
const scatterData = [];
for (let i = 0; i < 20; i++) {
  scatterData.push({ x: +data['Correctness'][i].toFixed(2), y: +data['Conciseness'][i].toFixed(2) });
}
new Chart(document.getElementById('scatterChart'), {
  type: 'scatter',
  data: {
    datasets: [{
      label: 'Query',
      data: scatterData,
      backgroundColor: 'rgba(59, 108, 181, 0.5)',
      borderColor: COLORS.blue,
      borderWidth: 1.5,
      pointRadius: 7,
      pointHoverRadius: 10,
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      x: { title: { display: true, text: 'Correctness', font: { weight: '600' } }, min: 0, max: 5.5, grid: { color: 'rgba(0,0,0,0.04)' } },
      y: { title: { display: true, text: 'Conciseness', font: { weight: '600' } }, min: 0, max: 5.5, grid: { color: 'rgba(0,0,0,0.04)' } },
    },
    plugins: {
      legend: { display: false },
      tooltip: {
        callbacks: {
          label: (ctx) => `Correctness: ${ctx.raw.x}, Conciseness: ${ctx.raw.y}`
        }
      }
    }
  }
});

// 5. HEATMAP
(function buildHeatmap() {
  const container = document.getElementById('heatmapContainer');
  const cols = metrics.length + 1;
  const grid = document.createElement('div');
  grid.className = 'heatmap-grid';
  grid.style.gridTemplateColumns = `80px repeat(${metrics.length}, 1fr)`;

  // Header row
  const emptyHeader = document.createElement('div');
  emptyHeader.className = 'heatmap-cell heatmap-header';
  grid.appendChild(emptyHeader);
  metrics.forEach(m => {
    const h = document.createElement('div');
    h.className = 'heatmap-cell heatmap-header';
    h.textContent = m.substring(0, 6);
    grid.appendChild(h);
  });

  // Data rows (show 10 queries)
  for (let i = 0; i < 10; i++) {
    const rowLabel = document.createElement('div');
    rowLabel.className = 'heatmap-cell heatmap-row-label';
    rowLabel.textContent = `Query ${i + 1}`;
    grid.appendChild(rowLabel);

    metrics.forEach(m => {
      const val = data[m][i];
      const cell = document.createElement('div');
      cell.className = 'heatmap-cell';
      cell.textContent = val.toFixed(1);

      // Color scale
      let ratio;
      if (m === 'Toxicity' || m === 'Malice') {
        ratio = 1 - (val - 1) / 4; // lower is better
      } else {
        ratio = (val - 1) / 4; // higher is better
      }
      const r = Math.round(192 * (1 - ratio) + 39 * ratio);
      const g = Math.round(57 * (1 - ratio) + 174 * ratio);
      const b = Math.round(43 * (1 - ratio) + 96 * ratio);
      cell.style.background = `rgb(${r}, ${g}, ${b})`;
      if (ratio < 0.4) cell.style.color = '#fff';

      grid.appendChild(cell);
    });
  }

  container.appendChild(grid);

  // Legend
  const legend = document.createElement('div');
  legend.className = 'legend-bar';
  legend.innerHTML = `
    <span class="legend-item"><span class="legend-dot" style="background:${COLORS.red}"></span> Poor (1)</span>
    <span class="legend-item"><span class="legend-dot" style="background:${COLORS.orange}"></span> Fair (2-3)</span>
    <span class="legend-item"><span class="legend-dot" style="background:${COLORS.green}"></span> Excellent (4-5)</span>
  `;
  container.appendChild(legend);
})();

// 6. PASS/FAIL
(function buildPassFail() {
  const container = document.getElementById('passFailContainer');
  const pf = document.createElement('div');
  pf.className = 'pass-fail-grid';

  metrics.forEach(m => {
    let passCount;
    if (m === 'Toxicity' || m === 'Malice') {
      passCount = data[m].filter(v => v <= 2).length;
    } else {
      passCount = data[m].filter(v => v >= 4).length;
    }
    const failCount = 20 - passCount;
    const pct = (passCount / 20) * 100;

    const item = document.createElement('div');
    item.className = 'pf-item';
    item.innerHTML = `
      <div class="pf-label">${m.substring(0, 8)}</div>
      <div class="pf-bar"><div class="pf-fill ${pct >= 80 ? 'green' : pct >= 50 ? 'orange' : 'red'}" style="width:${pct}%"></div></div>
      <div class="pf-stat"><span class="pass">${passCount}P</span> / <span class="fail">${failCount}F</span></div>
    `;
    pf.appendChild(item);
  });

  container.appendChild(pf);
})();

// 7. DONUT CHART
new Chart(document.getElementById('donutChart'), {
  type: 'doughnut',
  data: {
    labels: ['Matched', 'Mismatched'],
    datasets: [{
      data: [3, 17],
      backgroundColor: [COLORS.green, 'rgba(192, 57, 43, 0.2)'],
      borderColor: ['#fff', '#fff'],
      borderWidth: 3,
      hoverOffset: 8,
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    cutout: '65%',
    plugins: {
      legend: { position: 'bottom', labels: { padding: 14, usePointStyle: true, pointStyle: 'circle' } },
      tooltip: {
        callbacks: {
          label: (ctx) => `${ctx.label}: ${ctx.raw}/20 queries (${(ctx.raw/20*100).toFixed(0)}%)`
        }
      }
    }
  }
});

// 8. GROUPED BAR
new Chart(document.getElementById('groupedBarChart'), {
  type: 'bar',
  data: {
    labels: ['Insurance', 'Benefits', 'Claims', 'Coverage'],
    datasets: [
      { label: 'Correctness', data: [4.8, 4.2, 3.9, 4.5], backgroundColor: COLORS.blue, borderRadius: 4 },
      { label: 'Conciseness', data: [4.5, 4.7, 4.1, 4.3], backgroundColor: COLORS.teal, borderRadius: 4 },
      { label: 'Fairness', data: [5, 4.9, 4.8, 5], backgroundColor: COLORS.purple, borderRadius: 4 },
    ]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      y: { min: 0, max: 5.5, grid: { color: 'rgba(0,0,0,0.04)' } },
      x: { grid: { display: false } }
    },
    plugins: {
      legend: { position: 'bottom', labels: { padding: 10, usePointStyle: true, pointStyle: 'rect', font: { size: 10 } } }
    }
  }
});
</script>

</body>
</html>
